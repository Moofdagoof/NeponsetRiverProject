<!DOCTYPE html>
<html>
<head>
  <title>Neponset River Water Quality Map</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    #map {
      height: 100vh;
      width: 100%;
    }
    .popup-form input, .popup-form button {
      display: block;
      width: 90%;
      margin-bottom: 8px;
      padding: 5px;
    }
    .popup-form button {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: -2,
    zoomSnap: 0.5
  });

  const bounds = [[0, 0], [1000, 800]]; // Adjusted map bounds
  const image = L.imageOverlay('https://i.im.ge/2025/04/28/viaH08.Neponset-Watershed-map-page-001.jpeg', bounds).addTo(map);
  map.fitBounds(bounds);
  map.setView([500, 400], map.getZoom() + 2);

  function createPopupForm(locationName) {
    const formHtml = `
      <div class="popup-form">
        <h3>${locationName}</h3>
        <input type="number" id="ph" placeholder="pH level" required />
        <input type="date" id="date" required />
        <input type="time" id="time" required />
        <button onclick="submitData('${locationName}')">Submit</button>
      </div>
    `;
    return formHtml;
  }




function submitData(locationName) {
  const ph = document.getElementById('ph').value;
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;

  if (!ph || !date || !time) {
    alert('Please fill out all fields.');
    return;
  }

  const data = {
    location: locationName,
    ph: ph,
    date: date,
    time: time
  };

  fetch('https://script.google.com/macros/s/AKfycbzd6cXFetHKOoEyDvwAcOw44sCv-Bgl-L8Ei1pu_qxuo-lsIzgTeibtnzA5elRRduN1Tg/exec', {
  method: 'POST',
  mode: 'no-cors',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
})
  .then(() => {
    alert(`Data submitted!\nLocation: ${locationName}\nPH: ${ph}\nDate: ${date}\nTime: ${time}`);
    map.closePopup();
  })
  .catch((error) => {
    console.error('Error!', error.message);
  });
}


  // Add 3 pins
  const locations = [
    { name: "Walpole", coords: [375, 240] },
    { name: "Quincy", coords: [705, 624] },
    { name: "Dedham", coords: [573, 439]}
  ];

  locations.forEach(loc => {
    L.marker(loc.coords)
      .addTo(map)
      .bindPopup(createPopupForm(loc.name));
  });




  locations.forEach(loc => {
  L.marker(loc.coords)
    .addTo(map)
    .bindPopup(createPopupForm(loc.name));
});

// Coordinate logger for mapping
map.on('click', function(e) {
  const { lat, lng } = e.latlng;
  console.log(`[${lat.toFixed(0)}, ${lng.toFixed(0)}],`);
});

</script>

</body>
</html>
